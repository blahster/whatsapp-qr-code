<!-- filename: wa-qr.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>WhatsApp QR (India)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #0b1220;
        --surface: #0f172a;
        --surface-2: #111827;
        --text: #e6edf5;
        --muted: #9aa3b2;
        --border: #1f2a37;
        --accent: #2dd4bf;
        --accent-dark: #14b8a6;
        --accent-contrast: #073c37;
        --input-bg: #0b1324;
        --focus-ring: rgba(45, 212, 191, 0.18);
        --qr-bg: #ffffff;
        --qr-ink: #121212;
        --shadow: rgba(0, 0, 0, 0.35);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        background: linear-gradient(180deg, var(--bg), #0c1425 60%, #0a1020);
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial;
        display: block;
        padding: 16px;
      }

      .card {
        width: 100%;
        max-width: 860px;
        margin: 0 auto;
        border: 1px solid var(--border);
        border-radius: 18px;
        overflow: hidden;
        background: var(--surface-2);
        box-shadow: 0 22px 44px var(--shadow);
      }

      .header {
        position: sticky;
        top: 0;
        z-index: 1;
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(180deg, var(--surface), var(--surface-2));
      }

      .title {
        font-size: 20px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      .content {
        display: grid;
        grid-template-columns: 1.1fr 1fr;
        gap: 24px;
        padding: 16px;
      }
      @media (max-width: 900px) {
        .content {
          grid-template-columns: 1fr;
          gap: 16px;
          padding: 12px;
        }
      }

      .label {
        font-size: 15px;
        color: var(--muted);
        margin-bottom: 6px;
        font-weight: 600;
      }

      .hint {
        font-size: 15px;
        color: var(--muted);
        text-align: left;
        margin-top: 10px;
        opacity: 0;
        transform: translateY(-4px);
        transition: opacity 0.4s ease, transform 0.4s ease;
      }
      .hint.center {
        text-align: center;
      }
      .hint.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .row {
        display: flex;
        gap: 10px;
        align-items: stretch;
      }
      @media (max-width: 520px) {
        .row {
          flex-direction: column;
          gap: 8px;
        }
      }

      input[type="text"] {
        flex: 1;
        font-size: 16px;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: var(--input-bg);
        color: var(--text);
        outline: none;
        min-width: 0;
        transition: border-color 0.2s ease, box-shadow 0.2s ease,
          background 0.2s ease;
      }
      input[type="text"]::placeholder {
        color: #7c8798;
      }
      input[type="text"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--focus-ring);
        background: #0c1628;
      }

      button {
        font-size: 15px;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, var(--accent), var(--accent-dark));
        color: var(--accent-contrast);
        font-weight: 700;
        cursor: pointer;
        white-space: nowrap;
        transition: transform 0.06s ease-in-out, filter 0.15s ease,
          box-shadow 0.15s ease;
        box-shadow: 0 6px 14px rgba(20, 184, 166, 0.25);
      }
      button:hover {
        filter: brightness(1.03);
      }
      button:active {
        transform: translateY(1px);
        box-shadow: 0 4px 10px rgba(20, 184, 166, 0.22);
      }

      @media (max-width: 520px) {
        button {
          width: 100%;
        }
      }

      button:disabled {
        opacity: 0.65;
        cursor: not-allowed;
        filter: saturate(0.85);
        box-shadow: none;
      }

      .error {
        font-size: 12px;
        color: #f8b4b4;
        min-height: 16px;
        margin-top: 6px;
      }

      .url {
        font-size: 14px;
        color: var(--muted);
        word-break: break-all;
        padding: 8px 12px;
        background: var(--input-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        margin-top: 8px;
      }

      /* Hidden utility class */
      .hidden {
        display: none !important;
      }

      .url a {
        color: var(--accent);
        text-decoration: none;
        font-weight: 600;
      }
      .url a:hover {
        text-decoration: underline;
      }

      .actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }
      @media (max-width: 520px) {
        .actions {
          flex-direction: column;
        }
        .actions button {
          width: 100%;
        }
        .actions #download {
          display: none;
        }
      }

      .qr-card {
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--qr-bg);
        border-radius: 16px;
        border: 1px solid #e5e7eb;
        padding: 16px;
        width: 100%;
        max-width: 100%;
        overflow: auto;
        max-height: calc(100svh - 180px);
      }

      .mobile-download {
        display: none;
        margin-top: 10px;
      }
      @media (max-width: 520px) {
        .mobile-download {
          display: block;
        }
        .mobile-download button {
          width: 100%;
        }
      }

      canvas {
        display: block;
        width: 100%;
        max-width: 480px;
        height: auto;
        aspect-ratio: 1 / 1;
        max-height: 70svh;
        image-rendering: pixelated;
        background: var(--qr-bg);
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="header">
        <div class="title">WhatsApp QR Generator â€” India</div>
      </div>
      <div class="content">
        <div>
          <div class="label">10-digit Indian mobile number</div>
          <div class="row">
            <input
              id="phone"
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              placeholder="e.g., 9876543210"
              autofocus
            />
            <button id="generate" type="button">Generate</button>
          </div>
          <div id="error" class="error"></div>
          <div id="urlHint" class="hint hidden">
            Click the link to open in WhatsApp
          </div>
          <!-- Hidden until populated -->
          <div id="url" class="url hidden"></div>

          <!-- Actions (hidden until populated) -->
          <div id="actions" class="actions hidden">
            <button id="copyUrl" disabled>Copy URL</button>
            <button id="download" disabled>Download PNG</button>
          </div>
        </div>

        <div>
          <div id="qrHint" class="hint hidden" style="margin-bottom: 12px">
            Point your phone camera at the QR and click the link to open in
            WhatsApp
          </div>
          <!-- Hide QR container on load; show only after generating -->
          <div id="qrContainer" class="qr-card hidden">
            <canvas
              id="qrCanvas"
              width="480"
              height="480"
              aria-label="QR code"
            ></canvas>
          </div>
          <!-- Mobile-only Download button appears below QR on small screens; hidden until populated -->
          <div id="mobileDownload" class="mobile-download hidden">
            <button id="downloadMobile" disabled>Download PNG</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <script>
      const phoneInput = document.getElementById("phone");
      const generateBtn = document.getElementById("generate");
      const errorEl = document.getElementById("error");
      const urlEl = document.getElementById("url");
      const urlHintEl = document.getElementById("urlHint");
      const qrHintEl = document.getElementById("qrHint");
      const qrContainerEl = document.getElementById("qrContainer");
      const canvas = document.getElementById("qrCanvas");
      const actionsEl = document.getElementById("actions");
      const mobileDownloadEl = document.getElementById("mobileDownload");
      const copyUrlBtn = document.getElementById("copyUrl");
      const downloadBtn = document.getElementById("download");
      const downloadMobileBtn = document.getElementById("downloadMobile");

      let lastUrl = "";

      const validatePhone = (n) => /^\d{10}$/.test(n);
      const buildUrl = (n) => `https://wa.me/91${n}`;

      function drawToCanvasFromQRCode(qr, canvas, size) {
        canvas.width = size;
        canvas.height = size;

        const ctx = canvas.getContext("2d", { alpha: false });
        ctx.imageSmoothingEnabled = false;

        const count = qr._oQRCode
          ? qr._oQRCode.getModuleCount()
          : qr.getModuleCount();
        const cell = Math.floor(size / count);
        const margin = Math.floor((size - cell * count) / 2);

        const styles = getComputedStyle(document.documentElement);
        const qrBg = styles.getPropertyValue("--qr-bg").trim() || "#ffffff";
        const qrInk = styles.getPropertyValue("--qr-ink").trim() || "#000000";

        ctx.fillStyle = qrBg;
        ctx.fillRect(0, 0, size, size);
        ctx.fillStyle = qrInk;

        for (let r = 0; r < count; r++) {
          for (let c = 0; c < count; c++) {
            const dark = qr._oQRCode
              ? qr._oQRCode.isDark(r, c)
              : qr.isDark(r, c);
            if (dark) {
              ctx.fillRect(margin + c * cell, margin + r * cell, cell, cell);
            }
          }
        }
      }

      function hideOutputs() {
        // URL box
        urlEl.innerHTML = "";
        urlEl.classList.add("hidden");

        // Hints
        urlHintEl.classList.remove("visible");
        qrHintEl.classList.remove("visible");
        urlHintEl.classList.add("hidden");
        qrHintEl.classList.add("hidden");

        // Actions row
        actionsEl.classList.add("hidden");
        copyUrlBtn.disabled = true;
        downloadBtn.disabled = true;

        // QR container
        qrContainerEl.classList.add("hidden");

        // Mobile download
        mobileDownloadEl.classList.add("hidden");
        downloadMobileBtn.disabled = true;
      }

      function showOutputsAfterGenerate() {
        // Show URL
        urlEl.classList.remove("hidden");

        // Show hints
        urlHintEl.classList.remove("hidden");
        qrHintEl.classList.remove("hidden");
        urlHintEl.classList.add("visible");
        qrHintEl.classList.add("visible");

        // Show QR container
        qrContainerEl.classList.remove("hidden");

        // Show actions row and enable buttons
        actionsEl.classList.remove("hidden");
        copyUrlBtn.disabled = false;
        downloadBtn.disabled = false;

        // Show mobile download and enable button
        mobileDownloadEl.classList.remove("hidden");
        downloadMobileBtn.disabled = false;
      }

      function generate() {
        const raw = phoneInput.value.trim();
        errorEl.textContent = "";
        hideOutputs();

        if (!validatePhone(raw)) {
          errorEl.textContent = "Please enter exactly 10 digits (0â€“9).";
          return;
        }

        const url = buildUrl(raw);
        lastUrl = url;

        // Populate URL
        urlEl.innerHTML = `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;

        // Build QR
        const tempDiv = document.createElement("div");
        const qr = new QRCode(tempDiv, {
          text: url,
          width: 480,
          height: 480,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.Q,
        });
        drawToCanvasFromQRCode(qr, canvas, 480);

        // Reveal UI
        showOutputsAfterGenerate();
      }

      function copyUrl() {
        if (!lastUrl) return;
        navigator.clipboard
          .writeText(lastUrl)
          .then(() => {
            copyUrlBtn.textContent = "Copied!";
            setTimeout(() => {
              copyUrlBtn.textContent = "Copy URL";
            }, 1200);
          })
          .catch(() => alert("Could not copy URL"));
      }

      function downloadPNG() {
        if (!lastUrl) return;
        const a = document.createElement("a");
        a.href = canvas.toDataURL("image/png");
        a.download = "whatsapp_qr.png";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      phoneInput.addEventListener("input", (e) => {
        e.target.value = e.target.value.replace(/\D/g, "").slice(0, 10);
        if (e.target.value.length < 10) {
          hideOutputs();
        } else {
          errorEl.textContent = "";
        }
      });

      phoneInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          generate();
        }
      });

      generateBtn.addEventListener("click", generate);
      copyUrlBtn.addEventListener("click", copyUrl);
      downloadBtn.addEventListener("click", downloadPNG);
      downloadMobileBtn.addEventListener("click", downloadPNG);
    </script>
  </body>
</html>
